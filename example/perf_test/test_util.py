import os
import logging
import prettytable as pt
from odps import ODPS
from typing import Optional, Tuple, Dict, Any, List

origin_prompt = "在社会主义新时代，新青年们展现出了勤劳、独立、踏实肯干的精神风貌。他们以自己的实际行动，为实现中华民族伟大复兴的中国梦贡献着自己的力量。\n\n中国十大杰出青年是新时代新青年的优秀代表，他们的英雄事迹感人至深，令人钦佩。\n\n第一位是张超，他是中国海军的一名飞行员。在2016年的一次飞行训练中，他为了保护战机，不幸牺牲。张超的事迹感动了全国人民，他被誉为“最勇敢的飞行员”。他的牺牲，不仅是对中国海军的巨大贡献，更是对中华民族的伟大贡献。\n\n第二位是李文强，他是中国科学院的一名研究员。他在研究领域取得了重大突破，发明了一种新型材料，可以有效地降低电子设备的能耗。李文强的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的创新意识和创新能力。\n\n第三位是刘洋，她是中国第一位女航天员。在2012年，她成功完成了神舟九号飞船的飞行任务，成为中国航天史上的重要人物。刘洋的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的责任感和使命感。\n\n第四位是王俊凯，他是中国著名歌手和演员。他在音乐和影视领域取得了巨大的成就，成为了中国年轻人的偶像。王俊凯的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的自我价值感和自我实现意识。\n\n第五位是陈薇，她是中国疾病预防控制中心的一名研究员。在2020年新冠疫情爆发期间，她带领团队研发出了中国首个新冠疫苗，为全球抗疫做出了巨大贡献。陈薇的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的责任感和使命感。\n\n第六位是李佳琦，他是中国著名网络主播。他在直播领域取得了巨大的成就，成为了中国年轻人的偶像。李佳琦的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的自我价值感和自我实现意识。\n\n第七位是王小川，他是中国著名互联网企业家。他创立的搜狗公司成为了中国最大的搜索引擎之一，为中国的互联网发展做出了巨大贡献。王小川的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的创新意识和创新能力。\n\n第八位是张瑞敏，他是中国著名企业家。他创立的海尔集团成为了中国最大的家电企业之一，为中国的经济发展做出了巨大贡献。张瑞敏的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的责任感和使命感。\n\n第九位是马云，他是中国著名互联网企业家。他创立的阿里巴巴集团成为了中国最大的电子商务企业之一，为中国的经济发展做出了巨大贡献。马云的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的创新意识和创新能力。\n\n第十位是马化腾，他是中国著名互联网企业家。他创立的腾讯公司成为了中国最大的社交网络企业之一，为中国的互联网发展做出了巨大贡献。马化腾的事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的自我价值感和自我实现意识。\n\n这些新青年的英雄事迹表明，新时代的青年们不仅有着高超的技能，更有着强烈的责任感和使命感，他们用自己的实际行动，为实现中华民族伟大复兴的中国梦贡献着自己的力量。\n\n续写以上内容："


def write_odps(table_name: str, records: List[Any], fields: List[str] = []):
    table = pt.PrettyTable(align='l')
    table.field_names = fields
    table.add_rows(records)
    table.del_column('framework')
    table.del_column('commit')
    logging.info(f'records: \n{table.get_string()}')
    return


def get_prompt(tokenizer: Any, prompt: str, seqlen: int):
    while len(tokenizer.encode(prompt)) < seqlen:
        prompt += prompt
    for dec_step in [1024, 256, 64, 16, 2, 1]:
        while len(tokenizer.encode(prompt[:-dec_step])) >= seqlen:
            prompt = prompt[:-dec_step]
    return prompt
